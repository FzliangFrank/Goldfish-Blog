{
  "hash": "522cb98d45d3534c7cdcc3a07dd45c2a",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: Getting Data\n---\n\n### Overview\n\ncode in this notebook are written in `python`\n\nThere are two data source: \n\n  1. `csv` file downloaded directly from GTR website;\n  2. For project description, from GTR api;\n  3. Additional coordinate data using open-api;\n  \nAlthough from step1 and step2 we are able to get same number of data, only 86.05%\ncan join.\n\n::: {#80365f7b .cell execution_count=1}\n``` {.python .cell-code code-summary=\"library and setup\"}\nimport requests\nimport pandas as pd\nfrom IPython.display import display\n\n## define a function to check interactivity\n## so when render this document code take too long don't have to re-run everytime \nimport os\ndef is_interactive():\n   return 'SHLVL' not in os.environ\nprint('Interactive?', is_interactive())\n\n## Parameter\nSEARCH_TERM=\"artificial intelligence\"\nMAX_RESULTS=5175 # gathered by direct search \nURL = \"https://gtr.ukri.org/gtr/api/projects.json?sf=pro.sd&so=A\" # sort by project start date Decending (D) Acending(A)\n\nprint(f'Gathering data related to term \"{SEARCH_TERM}\", this has {MAX_RESULTS} results')\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nInteractive? False\nGathering data related to term \"artificial intelligence\", this has 5175 results\n```\n:::\n:::\n\n\n### From Download\n\n![Search term \"aritificial intelligence\" has option to download csv](figures/Screenshot 2024-03-03 at 15.51.38.png)\n\n::: {#c0dcea7c .cell execution_count=2}\n``` {.python .cell-code code-fold=\"show\" code-summary=\"example of the donwload\"}\ncsv_export = pd.read_csv('data/projectsearch-1709481069771.csv')\ndisplay(csv_export.sample(3))\n```\n\n::: {.cell-output .cell-output-display}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>FundingOrgName</th>\n      <th>ProjectReference</th>\n      <th>LeadROName</th>\n      <th>Department</th>\n      <th>ProjectCategory</th>\n      <th>PISurname</th>\n      <th>PIFirstName</th>\n      <th>PIOtherNames</th>\n      <th>PI ORCID iD</th>\n      <th>StudentSurname</th>\n      <th>...</th>\n      <th>EndDate</th>\n      <th>AwardPounds</th>\n      <th>ExpenditurePounds</th>\n      <th>Region</th>\n      <th>Status</th>\n      <th>GTRProjectUrl</th>\n      <th>ProjectId</th>\n      <th>FundingOrgId</th>\n      <th>LeadROId</th>\n      <th>PIId</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>5003</th>\n      <td>NERC</td>\n      <td>NE/M02086X/1</td>\n      <td>University of Essex</td>\n      <td>Life Sciences</td>\n      <td>Research Grant</td>\n      <td>Dumbrell</td>\n      <td>Alexander</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>...</td>\n      <td>31/12/2020</td>\n      <td>764323.0</td>\n      <td>NaN</td>\n      <td>East of England</td>\n      <td>Closed</td>\n      <td>http://internal-gtr-tomcat-alb-611010599.eu-we...</td>\n      <td>74C6D687-B820-4A93-8944-E31C3F5CB77E</td>\n      <td>8A03ED41-E67D-4F4A-B5DD-AAFB272B6471</td>\n      <td>09E8DBA6-A48F-43C3-AB86-C73A2666B10E</td>\n      <td>0AD50B14-EDCD-433F-AD3D-A79FB21243A1</td>\n    </tr>\n    <tr>\n      <th>856</th>\n      <td>NERC</td>\n      <td>NE/J006629/1</td>\n      <td>NERC CEH (Up to 30.11.2019)</td>\n      <td>Billett</td>\n      <td>Research Grant</td>\n      <td>Billett</td>\n      <td>Michael</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>...</td>\n      <td>11/08/2013</td>\n      <td>133273.0</td>\n      <td>NaN</td>\n      <td>South East</td>\n      <td>Closed</td>\n      <td>http://internal-gtr-tomcat-alb-611010599.eu-we...</td>\n      <td>99E0891B-9CDA-46D5-9735-37D96864DAC8</td>\n      <td>8A03ED41-E67D-4F4A-B5DD-AAFB272B6471</td>\n      <td>302DE0C3-6809-4EB5-BB59-F89E6BE3EDD9</td>\n      <td>669726BC-B188-46AC-9E5B-DF2D348302BD</td>\n    </tr>\n    <tr>\n      <th>2518</th>\n      <td>MRC</td>\n      <td>MR/V01157X/1</td>\n      <td>University of Glasgow</td>\n      <td>MRC Centre for Virus Research</td>\n      <td>Research Grant</td>\n      <td>Wilson</td>\n      <td>Sam</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>...</td>\n      <td>31/08/2023</td>\n      <td>612023.0</td>\n      <td>NaN</td>\n      <td>Scotland</td>\n      <td>Closed</td>\n      <td>http://internal-gtr-tomcat-alb-611010599.eu-we...</td>\n      <td>305F8763-9D52-4ECF-83D1-829C17A50287</td>\n      <td>C008C651-F5B0-4859-A334-5F574AB6B57C</td>\n      <td>595A5FEA-6A63-4445-BD0B-7CA0CC2EE7DF</td>\n      <td>DF41B605-8649-4D45-B6E3-592FB3EB3774</td>\n    </tr>\n  </tbody>\n</table>\n<p>3 rows Ã— 25 columns</p>\n</div>\n```\n:::\n:::\n\n\nUnfortunately this `csv` export don't contain project description. So we are manually \nextract this data using the API call.\n\n\n### From API\n\n::: {#4bb48aa1 .cell execution_count=3}\n``` {.python .cell-code code-summary=\"gathering project description\"}\n# GTR end-point\nif is_interactive():\n  print(\"Interactive context, fetch live data\")\n  ## Initialize a Data Frame\n  df = pd.DataFrame(columns = ['id', \"title\", \"abstractText\", \"techAbstractText\",\"potentialImpact\"])\n  i = int()\n  for i in range(1, MAX_RESULTS // 25 + 1):\n      parameters = {\n          \"q\":SEARCH_TERM,\n          \"s\":25,\n          \"p\":i\n          # \"f\":\"pro.rt\" # search in project topic \n      }\n      \n      response = requests.get(URL, params = parameters)\n      x = response.json()\n      dfx = pd.DataFrame.from_dict(x['project'])[[\"id\",\"title\",\"abstractText\",\"techAbstractText\",'potentialImpact']]\n      df = pd.concat([df,dfx])\n      \n      ## Save data.frame into a parquet \n      df.to_parquet('data/gtr.parquet')\n      api_export = df\nelse:\n  print(\"Skipping intractive\")\n  api_export = pd.read_parquet(\"data/gtr.parquet\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSkipping intractive\n```\n:::\n:::\n\n\n::: {#1bb04c96 .cell execution_count=4}\n``` {.python .cell-code code-summary=\"Sample Data\"}\ndisplay(api_export.sample(3))\n```\n\n::: {.cell-output .cell-output-display}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>id</th>\n      <th>title</th>\n      <th>abstractText</th>\n      <th>techAbstractText</th>\n      <th>potentialImpact</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>21</th>\n      <td>C7866802-704C-4B14-BAB4-B7B97B55C2E5</td>\n      <td>Machine Learning for Resource Management in Ne...</td>\n      <td>Recent developments in optical networking tech...</td>\n      <td>None</td>\n      <td>None</td>\n    </tr>\n    <tr>\n      <th>14</th>\n      <td>6E70ACBD-7E36-4999-8514-78619CF8E0C1</td>\n      <td>A novel circadian output circuit linking senso...</td>\n      <td>Sleep is essential for normal nervous system f...</td>\n      <td>Here we propose experiments to delineate and f...</td>\n      <td>Sleep is a critical and highly conserved behav...</td>\n    </tr>\n    <tr>\n      <th>17</th>\n      <td>190B610E-C3EB-440A-BF86-96021C64E4C1</td>\n      <td>CiViL: Common-sense- and Visually-enhanced nat...</td>\n      <td>One of the most compelling problems in Artific...</td>\n      <td>None</td>\n      <td>Autonomous and intelligent systems are becomin...</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n### Data Quality\n\n::: {#d0fea8bf .cell execution_count=5}\n``` {.python .cell-code code-fold=\"show\" code-summary=\"Basic Validations\"}\n## check api export\nassert api_export.shape[0] == api_export.id.unique().shape[0], \"Check `field id` is unique\"\n\n## check csv export\nassert csv_export.shape[0] == csv_export.ProjectId.unique().shape[0], \"Check `field id` ProjectID is unique\"\n\n## check relationships\n## check if csv and api call returned same number of rows\nassert api_export.shape[0] - csv_export.shape[0] == 0, \"API and manual search result return the same rows\"\n```\n:::\n\n\n::: {#f7eee8b0 .cell execution_count=6}\n``` {.python .cell-code code-fold=\"show\" code-summary=\"join key check\"}\nfrom numpy import intersect1d, setdiff1d\n\napi_id = api_export.id.values\ncsv_id = csv_export.ProjectId.values\n\ncommon = intersect1d(api_id,csv_id,assume_unique=True)\napi_extra = setdiff1d(api_id,csv_id,assume_unique=True)\ncsv_extra = setdiff1d(csv_id, api_id,assume_unique=True)\n\nprint(f'''\nWe can join {((common.shape[0] / csv_export.shape[0]) * 100):.02f} % of data\n\nDetails here:\n- {common.shape[0]} can join;\n- {api_extra.shape[0]} extra projects from api;\n- {csv_extra.shape[0]} extra projects from csv download;\n''')\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nWe can join 86.05 % of data\n\nDetails here:\n- 4453 can join;\n- 722 extra projects from api;\n- 722 extra projects from csv download;\n\n```\n:::\n:::\n\n\n::: {#d778643a .cell execution_count=7}\n``` {.python .cell-code code-fold=\"show\"}\n## Example of extra API export\ndisplay(api_export.query(\"id.isin(@api_extra)\").sample(3))\n```\n\n::: {.cell-output .cell-output-display}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>id</th>\n      <th>title</th>\n      <th>abstractText</th>\n      <th>techAbstractText</th>\n      <th>potentialImpact</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>14</th>\n      <td>73C0F6C2-3D17-49DE-856E-0959477F53D2</td>\n      <td>Towards More Effective Multi-objective Meta-He...</td>\n      <td>This research project proposes the investigati...</td>\n      <td>None</td>\n      <td>None</td>\n    </tr>\n    <tr>\n      <th>16</th>\n      <td>CCF621C5-1FF1-4601-B873-F5E740369EC7</td>\n      <td>Testing Autonomous Vehicle Software using Situ...</td>\n      <td>Autonomous vehicles (AVs) must be controlled b...</td>\n      <td>None</td>\n      <td>The short-term result of the project will be a...</td>\n    </tr>\n    <tr>\n      <th>17</th>\n      <td>E3B3EE92-CD36-404F-8A9E-FF63FE58427D</td>\n      <td>Thales-Bristol Partnership in Hybrid Autonomou...</td>\n      <td>Hybrid autonomous systems are those where grou...</td>\n      <td>None</td>\n      <td>The business benefits of T-B PHASE are:\\n\\n- L...</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n::: {#6edd77bf .cell execution_count=8}\n``` {.python .cell-code code-fold=\"show\"}\n## Example of extra CSV export\ndisplay(csv_export.query(\"ProjectId.isin(@csv_extra)\").sample(3))\n```\n\n::: {.cell-output .cell-output-display}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>FundingOrgName</th>\n      <th>ProjectReference</th>\n      <th>LeadROName</th>\n      <th>Department</th>\n      <th>ProjectCategory</th>\n      <th>PISurname</th>\n      <th>PIFirstName</th>\n      <th>PIOtherNames</th>\n      <th>PI ORCID iD</th>\n      <th>StudentSurname</th>\n      <th>...</th>\n      <th>EndDate</th>\n      <th>AwardPounds</th>\n      <th>ExpenditurePounds</th>\n      <th>Region</th>\n      <th>Status</th>\n      <th>GTRProjectUrl</th>\n      <th>ProjectId</th>\n      <th>FundingOrgId</th>\n      <th>LeadROId</th>\n      <th>PIId</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>144</th>\n      <td>Horizon Europe Guarantee</td>\n      <td>10078198</td>\n      <td>SHEFFIELD HALLAM UNIVERSITY</td>\n      <td>NaN</td>\n      <td>EU-Funded</td>\n      <td>Akhgar</td>\n      <td>Babak</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>...</td>\n      <td>31/10/2026</td>\n      <td>486568.0</td>\n      <td>NaN</td>\n      <td>Yorkshire and The Humber</td>\n      <td>Active</td>\n      <td>http://internal-gtr-tomcat-alb-611010599.eu-we...</td>\n      <td>5F03F3D3-21F9-4D72-873A-7E02BA9FC346</td>\n      <td>240CEBFD-1052-4EAC-88DF-D88A163D61C8</td>\n      <td>5F8915AC-8108-45EC-817D-E0123EFD9E9E</td>\n      <td>877B75B5-46D0-401D-8905-8AE2DE5F1251</td>\n    </tr>\n    <tr>\n      <th>3149</th>\n      <td>Horizon Europe Guarantee</td>\n      <td>10065388</td>\n      <td>THRIDIUM LIMITED</td>\n      <td>NaN</td>\n      <td>EU-Funded</td>\n      <td>Bunduc</td>\n      <td>Oana</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>...</td>\n      <td>31/12/2025</td>\n      <td>259403.0</td>\n      <td>NaN</td>\n      <td>London</td>\n      <td>Active</td>\n      <td>http://internal-gtr-tomcat-alb-611010599.eu-we...</td>\n      <td>0FDB0DDA-A546-4E42-840F-3A264B3AF1F9</td>\n      <td>240CEBFD-1052-4EAC-88DF-D88A163D61C8</td>\n      <td>19EFA79F-49E9-4095-B570-E7BBF27541AD</td>\n      <td>BCDED8CE-1A0E-4828-9E7A-1A91E20A818B</td>\n    </tr>\n    <tr>\n      <th>2381</th>\n      <td>BBSRC</td>\n      <td>BB/X013243/1</td>\n      <td>University of Bristol</td>\n      <td>Computer Science</td>\n      <td>Research Grant</td>\n      <td>Froudist-Walsh</td>\n      <td>Sean</td>\n      <td>NaN</td>\n      <td>http://orcid.org/0000-0003-4070-067X</td>\n      <td>NaN</td>\n      <td>...</td>\n      <td>08/08/2024</td>\n      <td>199286.0</td>\n      <td>NaN</td>\n      <td>South West</td>\n      <td>Active</td>\n      <td>http://internal-gtr-tomcat-alb-611010599.eu-we...</td>\n      <td>E1A19CCC-A2F2-4860-ABC6-6B7827E66503</td>\n      <td>2512EF1C-401B-4222-9869-A770D4C5FAC7</td>\n      <td>25335D80-2025-4154-989F-37646A6EFBE1</td>\n      <td>A1FAB163-268D-4F17-B163-FA7274479238</td>\n    </tr>\n  </tbody>\n</table>\n<p>3 rows Ã— 25 columns</p>\n</div>\n```\n:::\n:::\n\n\n",
    "supporting": [
      "01_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}